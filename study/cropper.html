<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Cropper</title>
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="../node_modules/cropper/dist/cropper.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="container-fluid cropper">
    <div class="clearfix">
        <!--<form class="form-inline col-xs-12">-->
            <!--<div class="form-group">-->
                <!--<label class="control-label">选择本地图片：</label>-->
                <!--<input type="file" class="form-control" onchange="repalceImg(this);">-->
            <!--</div>-->
        <!--</form>-->
        <div class="cropper-warp col-xs-8">
            <img id="image" src="img/picture.jpg">
        </div>
        <div class="col-xs-4">
            <div class="img-preview"></div>
        </div>
        <div class="col-xs-12">
            <label class="btn btn-primary btn-upload" for="inputImage" title="Upload image file">
                <input type="file" class="sr-only" id="inputImage" name="file" accept="image/*">
                choose a new image
            </label>
            <button id="cropper-reset" title="Reset" class="btn btn-primary">Reset</button>
            <button id="cropper-save" title="Save" class="btn btn-success">Save</button>
        </div>
    </div>
</div>
<script src="../node_modules/jquery/dist/jquery.min.js"></script>
<script src="../node_modules/cropper/dist/cropper.js"></script>
<script>
    $(function () {
        "use strict";
        var RatioX = 200;
        var Ratioy = 150;
        var console = window.console || { log: function () {} };
        var $image = $('#image');
        var options = {
            dragMode:'move',
            aspectRatio: RatioX / Ratioy,
            cropBoxResizable:false,
            preview: '.img-preview'
        };
        $image.cropper(options);

        $('.img-preview').css({width:RatioX+'px',height:Ratioy+'px'});
        $('#cropper-reset').on('click',function(){
            $image.cropper('reset');
        });
        $('#cropper-save').on('click',function(){
            $image.cropper('getCroppedCanvas').toBlob(function (blob) {
                var formData = new FormData();

                formData.append('croppedImage', blob);

                $.ajax('/path/to/upload', {
                    method: "POST",
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function () {
                        console.log('Upload success');
                    },
                    error: function () {
                        console.log('Upload error');
                    }
                });
            });
        });

        // Import image
        var $inputImage = $('#inputImage');
        var URL = window.URL || window.webkitURL;
        var blobURL;

        if (URL) {
            $inputImage.change(function () {
                var files = this.files;
                var file;

                if (!$image.data('cropper')) {
                    return;
                }

                if (files && files.length) {
                    file = files[0];

                    if (/^image\/\w+$/.test(file.type)) {
                        blobURL = URL.createObjectURL(file);
                        $image.one('built.cropper', function () {

                            // Revoke when load complete
                            URL.revokeObjectURL(blobURL);
                        }).cropper('reset').cropper('replace', blobURL);
                        $inputImage.val('');
                    } else {
                        window.alert('Please choose an image file.');
                    }
                }
            });
        } else {
            $inputImage.prop('disabled', true).parent().addClass('disabled');
        }

    });
</script>
</body>
</html>